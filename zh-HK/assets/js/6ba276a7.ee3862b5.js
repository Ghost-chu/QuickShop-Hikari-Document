"use strict";(self.webpackChunkquick_shop_hikari_documents=self.webpackChunkquick_shop_hikari_documents||[]).push([[2957],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),k=r,d=u["".concat(s,".").concat(k)]||u[k]||m[k]||i;return a?n.createElement(d,l(l({ref:t},c),{},{components:a})):n.createElement(d,l({ref:t},c))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},4953:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={},l="Packet System for Virtual Display Items",o={unversionedId:"development/protocol-system",id:"development/protocol-system",title:"Packet System for Virtual Display Items",description:"Overview",source:"@site/docs/development/06-protocol-system.md",sourceDirName:"development",slug:"/development/protocol-system",permalink:"/QuickShop-Hikari-Documents/zh-HK/docs/development/protocol-system",draft:!1,editUrl:"https://crowdin.com/project/quickshop-hikari-documents/zh-HK",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"0x05 Per shop permission",permalink:"/QuickShop-Hikari-Documents/zh-HK/docs/development/per-shop-permission-management"}},s={},p=[{value:"Overview",id:"overview",level:2},{value:"Key Components",id:"key-components",level:2},{value:"1. <strong>PacketHandler</strong>",id:"1-packethandler",level:3},{value:"2. <strong>PacketFactory</strong>",id:"2-packetfactory",level:3},{value:"3. <strong>VirtualDisplayItemManager</strong>",id:"3-virtualdisplayitemmanager",level:3},{value:"4. <strong>VirtualDisplayItem</strong>",id:"4-virtualdisplayitem",level:3},{value:"5. <strong>ProtocolLibHandler and PacketEventsHandler</strong>",id:"5-protocollibhandler-and-packeteventshandler",level:3},{value:"Expanding the Protocol System",id:"expanding-the-protocol-system",level:2},{value:"Implementing a New PacketHandler",id:"implementing-a-new-packethandler",level:3},{value:"Implementing a New PacketFactory",id:"implementing-a-new-packetfactory",level:3},{value:"Supported Game Versions",id:"supported-game-versions",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Resources",id:"resources",level:2},{value:"Contact",id:"contact",level:2}],c={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"packet-system-for-virtual-display-items"},"Packet System for Virtual Display Items"),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"The Packet System in this project is designed to manage the creation, handling, and transmission of packets that facilitate the display of virtual items in Minecraft. It abstracts the underlying networking complexities, allowing seamless integration with multiple versions of the game."),(0,r.kt)("p",null,"This documentation will guide developers through the components, implementation details, and usage of the Packet System."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"key-components"},"Key Components"),(0,r.kt)("h3",{id:"1-packethandler"},"1. ",(0,r.kt)("strong",{parentName:"h3"},"PacketHandler")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Purpose"),": Manages packet handling and initialization logic."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Interface"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketHandler<T>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Key Methods"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Map<String, PacketFactory<?>> factories()"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Retrieves a map of supported ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactory")," instances keyed by game versions."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"void initialize()"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Initializes the packet handler."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Optional<PacketFactory<?>> factory(String version)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Retrieves a ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactory")," for a specific game version.")))))),(0,r.kt)("h3",{id:"2-packetfactory"},"2. ",(0,r.kt)("strong",{parentName:"h3"},"PacketFactory")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Purpose"),": Creates and sends specific packet types."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Interface"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactory<T>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Supported Packets"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Spawn Packet"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Spawns a virtual item at a specified location. Typically created using ",(0,r.kt)("inlineCode",{parentName:"li"},"createSpawnPacket()"),"."),(0,r.kt)("li",{parentName:"ul"},"Example Use: Representing shop items visually."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Metadata Packet"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Updates an entity's metadata, such as appearance or name. Created using ",(0,r.kt)("inlineCode",{parentName:"li"},"createMetaDataPacket()"),"."),(0,r.kt)("li",{parentName:"ul"},"Example Use: Updating item display name or properties."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Velocity Packet"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Assigns motion or velocity to an entity. Created using ",(0,r.kt)("inlineCode",{parentName:"li"},"createVelocityPacket()"),"."),(0,r.kt)("li",{parentName:"ul"},"Example Use: Custom animations for virtual items."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Destroy Packet"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Removes the entity from the client view. Created using ",(0,r.kt)("inlineCode",{parentName:"li"},"createDestroyPacket()"),"."),(0,r.kt)("li",{parentName:"ul"},"Example Use: Unloading or removing a virtual display item.")))))),(0,r.kt)("p",null,"Developers implementing custom ",(0,r.kt)("inlineCode",{parentName:"p"},"PacketFactory")," should ensure these packets are correctly handled and optimized for performance."),(0,r.kt)("h3",{id:"3-virtualdisplayitemmanager"},"3. ",(0,r.kt)("strong",{parentName:"h3"},"VirtualDisplayItemManager")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Purpose"),": Oversees the lifecycle of virtual display items and integrates with packet handlers."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Key Features"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Registers and initializes ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketHandler")," instances (e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"ProtocolLibHandler")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketEventsHandler"),")."),(0,r.kt)("li",{parentName:"ul"},"Manages virtual display items mapped to chunks."),(0,r.kt)("li",{parentName:"ul"},"Provides thread-safe operations for adding and removing display items.")))),(0,r.kt)("h3",{id:"4-virtualdisplayitem"},"4. ",(0,r.kt)("strong",{parentName:"h3"},"VirtualDisplayItem")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Purpose"),": Represents a virtual item displayed to players."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Key Features"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Generates and caches packets for spawning, metadata, velocity, and destruction."),(0,r.kt)("li",{parentName:"ul"},"Manages packet senders for each player."),(0,r.kt)("li",{parentName:"ul"},"Handles spawn and removal operations dynamically.")))),(0,r.kt)("h3",{id:"5-protocollibhandler-and-packeteventshandler"},"5. ",(0,r.kt)("strong",{parentName:"h3"},"ProtocolLibHandler and PacketEventsHandler")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Purpose"),": Provide implementations of ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketHandler")," using ProtocolLib and PacketEvents, respectively."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Differences"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ProtocolLibHandler")," leverages ProtocolLib API."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PacketEventsHandler")," uses the PacketEvents library.")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"expanding-the-protocol-system"},"Expanding the Protocol System"),(0,r.kt)("p",null,"Developers looking to extend or customize the protocol system can follow these steps:"),(0,r.kt)("h3",{id:"implementing-a-new-packethandler"},"Implementing a New PacketHandler"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * Custom implementation of a PacketHandler.\n * This should initialize and manage packet factories for different game versions.\n * \n * @param <T> The internal API instance of the packet library being used.\n */\npublic class CustomPacketHandler implements PacketHandler<T> {\n    \n    private final Map<String, PacketFactory<?>> factories = new HashMap<>();\n    \n    @Override\n    public Map<String, PacketFactory<?>> factories() {\n        return factories;\n    }\n\n    @Override\n    public String identifier() {\n        return "customHandler";\n    }\n\n    @Override\n    public String pluginName() {\n        return "CustomPacketPlugin";\n    }\n\n    @Override\n    public void initialize() {\n        factories.put("1.22", new CustomPacketFactory());\n    }\n}\n')),(0,r.kt)("h3",{id:"implementing-a-new-packetfactory"},"Implementing a New PacketFactory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * Custom implementation of a PacketFactory.\n * Provides methods to create and send packets for a specific game version.\n */\npublic class CustomPacketFactory implements PacketFactory<CustomPacket> {\n\n    @Override\n    public CustomPacket createSpawnPacket(int id, @NotNull Location displayLocation) {\n        return new CustomPacket("spawn", id, displayLocation);\n    }\n\n    @Override\n    public CustomPacket createMetaDataPacket(int id, @NotNull ItemStack itemStack) {\n        return new CustomPacket("metadata", id, itemStack);\n    }\n\n    @Override\n    public boolean sendPacket(@NotNull Player player, @NotNull CustomPacket packet) {\n        player.sendMessage("Sending packet: " + packet.getType());\n        return true;\n    }\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"supported-game-versions"},"Supported Game Versions"),(0,r.kt)("p",null,"Packet factories are provided for specific game versions through two primary implementations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ProtocolLib"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Versions: 1.20.1 - 1.21.4"),(0,r.kt)("li",{parentName:"ul"},"Factories: ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactoryv1_20"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactoryv1_21")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PacketEvents"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Versions: 1.20.1 - 1.21.4"),(0,r.kt)("li",{parentName:"ul"},"Factories: ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactoryv1_20"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"PacketFactoryv1_21"))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"best-practices"},"Best Practices"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Always unregister chunk listeners (",(0,r.kt)("inlineCode",{parentName:"li"},"unregisterSendChunk"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"unregisterUnloadChunk"),") during cleanup."),(0,r.kt)("li",{parentName:"ol"},"Use thread-safe methods in ",(0,r.kt)("inlineCode",{parentName:"li"},"VirtualDisplayItemManager")," for modifying mappings."),(0,r.kt)("li",{parentName:"ol"},"Ensure that packet libraries (ProtocolLib, PacketEvents) are updated to the latest version.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/dmulloy2/ProtocolLib"},"ProtocolLib Documentation"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/retrooper/packetevents"},"PacketEvents Documentation")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"contact"},"Contact"),(0,r.kt)("p",null,"For further assistance, please reach out to the development team or refer to the source code for detailed implementations."))}m.isMDXComponent=!0}}]);